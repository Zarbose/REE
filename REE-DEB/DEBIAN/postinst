#/bin/bash -u

LOG_FILE="/var/log/REE.log"

# Fonction pour ajouter un timestamp aux messages de logs
log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
}

# Verification si première Pi ou non 
ifconfig eth0 | grep -q 'inet '
if [ $? -eq 0 ]; then
    log "postinst pour raspberry 1 "
else
    log "postinst pour raspberry N "

    echo "[Unit]
    Description=Service qui se lance au demarage et qui crée un cronjob

    [Service]
    ExecStart=/usr/local/bin/cronjobscript
    Restart=always
    User=pi

    [Install]
    WantedBy=multi-user.target" > /etc/systemd/system/REEBoot.service

    systemctl enable REEBoot.service
    systemctl start REEBoot.service


fi
