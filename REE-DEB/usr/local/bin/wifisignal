#!/bin/bash

# SEUIL_WIFI_SIGNAL=153
SEUIL_WIFI_SIGNAL=153

while true; 
do  
    
    declare -a tableau
    for ((i=0; i<10; i++)); do
        SIGNAL=$(sudo batctl meshif bat0 o | tr -d "*()" | awk  '{print $3}' | tail -n +3 | sort -n -r | head -n 1)
        tableau+=($(echo $SIGNAL))x
        sleep 0.1
    done
    somme=0
    for valeur in "${tableau[@]}"; do
        somme=$((somme + valeur))
    done
    moyenne=$((somme / ${#tableau[@]}))

    echo $moyenne

    if [ $moyenne -lt $SEUIL_WIFI_SIGNAL ]
    then
        echo "Signal Wi-Fi trop faible. DÃ©clenchement de l'alarme..."
        espeak "Stop"
        sleep 0.3
        espeak "Stop"
        sleep 0.3
        espeak "Stop"

        exit 0
    fi
    unset tableau
done

