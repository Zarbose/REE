#!/bin/bash

LOG_FILE="/var/log/REE.log"

log() {
    echo "$(date '+%Y-%m-%d %H:%M:%S') - $1" >> "$LOG_FILE"
}

while true; do

    ipwlan1=$(ifconfig wlan1 | grep 'inet ' | awk '{print $2}')
    ipwlan0=$(echo "$ipwlan1" | awk -F'.' '{print $1"."$2"."$3 + 1 "."1}')
    iprouter=$(echo "$ipwlan1" | awk -F'.' '{print $1"."$2"."$3 "."1}')

    if [ "$(ip route list | wc -l)" -gt 4 ]; then
        # Supprimer les routes inutiles
        ip route del default via $iprouter dev wlan0 src $ipwlan0 metric 303
        ip route del $iprouter dev wlan0 scope link src $ipwlan0 metric 303

        ip route del default via $iprouter dev eth0
        ip route del $iprouter dev eth0
      
        log "Cleaning des routes hostapd inutiles."


    fi

    sleep 15
done
